# コードベース改善計画

現在のコードベースの保守性、テスト容易性、可読性を向上させるためのリファクタリング計画を提案します。

## 提案する変更点

1.  **設定管理の集約 (`Config` 構造体の導入)**
    -   環境変数からの読み込みを責務とする `Config` 構造体と `NewConfig` ファクトリ関数を `handler.go` に新設します。
    -   これにより、設定の管理が一元化され、コード全体の見通しが良くなります。

2.  **ビジネスロジックの分離 (`handler.go` の作成)**
    -   Lambdaの主要な処理を `main.go` から新しい `handler.go` ファイルに分離します。
    -   依存関係（設定、HTTPクライアント、New Relicクライアント）を保持する `LambdaHandler` 構造体を定義します。
    -   SwitchBot APIからのデータ取得、New Relicへのデータ送信などの各ロジックを、`LambdaHandler` のプライベートメソッドとして分割し、単一責任の原則を徹底します。

3.  **エラーハンドリングの改善**
    -   Lambda関数を途中で終了させてしまう `log.Fatal` の使用を廃止し、`fmt.Errorf` を用いてエラーを呼び出し元に返すように統一します。これにより、Lambdaはより適切なエラーレスポンスを返すことができます。

4.  **`main.go` の責務の明確化**
    -   リファクタリング後の `main` 関数は、依存関係の初期化（Configの読み込み、New Relicクライアントの生成）と、`LambdaHandler` を起動する責務のみに集中させます。

5.  **テストコードの更新 (`main_test.go`)**
    -   上記の変更に合わせて、`main_test.go` を更新し、新しい `LambdaHandler` のロジックをテストするように修正します。

## 期待される効果

-   **保守性の向上:** 各コンポーネントが疎結合になり、変更が容易になります。
-   **テストの容易化:** 依存関係が注入される設計になるため、ユニットテストが書きやすくなります。
-   **可読性の向上:** コードの責務が明確に分割され、処理の流れが追いやすくなります。
